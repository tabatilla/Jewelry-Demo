<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        margin: 0;
        height: 100vh;
      }

      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <button id="btn-navy-blue" onclick="cambiarColor(0x1c2744);">
      Navy Blue
    </button>
    <button id="btn-green" onclick="cambiarColor(0x263b39);">Green</button>
    <button id="btn-silver" onclick="cambiarColor(0xa0a394);">Silver</button>
    <button id="btn-bungurdy" onclick="cambiarColor(0x660e21);">
      Bungurdy
    </button>
    <button id="btn-black" onclick="cambiarColor(0x2c2f36);">Black</button>
    <button id="btn-pearl" onclick="cambiarColor(0xe5e7da);">Pearl</button>
    <button id="btn-brown" onclick="cambiarColor(0x352117);">Brown</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/105/three.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script> -->
    <script src="js/OrbitControls.js"></script>
    <script>
      const PIXEL_SIZE = 24;
      const TRAY_WIDTH = 23;
      const TRAY_HEIGHT = 17;
      const ANCHO_BORDE_LATERAL = 15;

      var geometries = [];

      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera(
        45,
        window.innerWidth / window.innerHeight,
        1,
        5000
      );
      camera.position.set(TRAY_WIDTH / 2, TRAY_HEIGHT / 2, 700);
      //camera.rotation.y = Math.PI / 2;

      var renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setClearColor("#E9E0D0");
      renderer.setSize(window.innerWidth, window.innerHeight);

      document.body.appendChild(renderer.domElement);

      window.addEventListener("resize", () => {
        renderer.setSize(window.innerWidth, window.innerHeight);
        camera.aspect = window.innerWidth / window.innerHeight;

        camera.updateProjectionMatrix();
      });

      //Controls
      var controls = new THREE.OrbitControls(camera);
      controls.rotateSpeed = 1.0;
      controls.zoomSpeed = 1.2;
      controls.panSpeed = 0.8;
      controls.target = new THREE.Vector3(
        (TRAY_WIDTH / 2) * PIXEL_SIZE,
        (TRAY_HEIGHT / 2) * PIXEL_SIZE,
        0
      );
      //Scene
      scene = new THREE.Scene();

      // Helpers
      //axes = new THREE.AxisHelper(50);
      var helper = new THREE.GridHelper(1000, 10);
      helper.setColors(0x0000ff, 0x808080);
      //scene.add(axes);
      //scene.add(helper);

      ////////////// 3D Element ///////////////
      //   var geometry = new THREE.SphereGeometry(1, 15, 70);
      //   var material = new THREE.MeshLambertMaterial({ color: 0xffcc00 });
      //   var mesh = new THREE.Mesh(geometry, material);

      // var geometry = new THREE.BoxGeometry(100, 100, 100);
      // var material = new THREE.MeshLambertMaterial({ color: 0xffcc00 });
      // var mesh = new THREE.Mesh(geometry, material);

      // mesh.position.set(0, 0, 0);

      //scene.add(mesh);

      //Creación Joyero
      var materialFondo = new THREE.MeshLambertMaterial({
        color: 0x660e21,
        side: THREE.DoubleSide
      });

      var materialBorde = new THREE.MeshLambertMaterial({
        color: 0x660e21,
        side: THREE.DoubleSide
      });

      //FONDO
      var fondoGeometry = new THREE.PlaneGeometry(
        PIXEL_SIZE * TRAY_WIDTH,
        PIXEL_SIZE * TRAY_HEIGHT
      );

      var fondo = new THREE.Mesh(fondoGeometry, materialFondo);
      fondo.position.set(
        (PIXEL_SIZE * TRAY_WIDTH) / 2,
        (PIXEL_SIZE * TRAY_HEIGHT) / 2,
        -11
      );
      scene.add(fondo);

      crearMarco(
        TRAY_WIDTH / 2,
        TRAY_HEIGHT / 2,
        TRAY_WIDTH,
        TRAY_HEIGHT,
        0.5,
        20
      );

      var celdas = [
        { x: 12, y: 0, w: 4, h: 14 },
        { x: 0, y: 0, w: 12, h: 6 },
        { x: 0, y: 6, w: 12, h: 6 },
        { x: 16, y: 0, w: 7, h: 17 },
        { x: 0, y: 12, w: 12, h: 5 },
        { x: 12, y: 14, w: 4, h: 3 }
      ];

      for (let i = 0; i < celdas.length; i++) {
        crearMarco(
          celdas[i].x + celdas[i].w / 2,
          celdas[i].y + celdas[i].h / 2,
          celdas[i].w,
          celdas[i].h,
          0.2,
          20
        );
      }

      // var light = new THREE.PointLight(0xff0000, 1, 50);
      // light.position.set(1000, 0, 25);
      // scene.add(light);

      //var light = new THREE.HemisphereLight(0xffbf67, 0x15c6ff);
      var light = new THREE.SpotLight(0xffffff);
      light.position.set(
        (TRAY_WIDTH / 2) * PIXEL_SIZE,
        (TRAY_HEIGHT / 2) * PIXEL_SIZE,
        620
      );

      var spotLightHelper = new THREE.SpotLightHelper(light);
      scene.add(spotLightHelper);
      scene.add(light);

      var render = () => {
        requestAnimationFrame(render);

        //mesh.rotation.x += 0.01;

        renderer.render(scene, camera);
        controls.update();
      };

      render();

      //Animaciones con otra librería
      // this.tl = new TimelineMax().delay(0.3);
      // this.tl.to(this.mesh.scale, 1, { x: 2, ease: Expo.easeOut });
      // this.tl.to(this.mesh.scale, 0.5, { x: 0.5, ease: Expo.easeOut });
      // this.tl.to(this.mesh.position, 0.5, { x: 2, ease: Expo.easeOut });
      // this.tl.to(this.mesh.rotation, 0.5, {
      //   y: Math.PI * 0.5,
      //   ease: Expo.easeOut
      // });

      function crearMarco(x, y, w, h, anchoBorde, profundidad) {
        var BordesVerticalesGeometry = new THREE.BoxGeometry(
          anchoBorde * PIXEL_SIZE,
          PIXEL_SIZE * h,
          profundidad
        );
        var BordesHorizontalesGeometry = new THREE.BoxGeometry(
          PIXEL_SIZE * w,
          anchoBorde * PIXEL_SIZE,
          profundidad
        );

        var bordeIzq = new THREE.Mesh(BordesVerticalesGeometry, materialBorde);
        var bordeDer = new THREE.Mesh(BordesVerticalesGeometry, materialBorde);
        var bordeSup = new THREE.Mesh(
          BordesHorizontalesGeometry,
          materialBorde
        );
        var bordeInf = new THREE.Mesh(
          BordesHorizontalesGeometry,
          materialBorde
        );

        bordeIzq.position.set(
          (x - w / 2 + anchoBorde / 2) * PIXEL_SIZE,
          y * PIXEL_SIZE,
          0
        );
        bordeDer.position.set(
          (x + w / 2 - anchoBorde / 2) * PIXEL_SIZE,
          y * PIXEL_SIZE,
          0
        );
        bordeSup.position.set(
          x * PIXEL_SIZE,
          (y + h / 2 - anchoBorde / 2) * PIXEL_SIZE,
          0
        );
        bordeInf.position.set(
          x * PIXEL_SIZE,
          (y - h / 2 + anchoBorde / 2) * PIXEL_SIZE,
          0
        );

        scene.add(bordeIzq);
        scene.add(bordeDer);
        scene.add(bordeSup);
        scene.add(bordeInf);

        return;
      }

      function cambiarColor(color) {
        scene.traverse(function(node) {
          if (node instanceof THREE.Mesh) {
            // insert your code here, for example:
            node.material.color.setHex(color);
          }
        });
      }
    </script>
  </body>
</html>
